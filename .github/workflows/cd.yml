name: Continuous Deployment

on:
  workflow_run:
    workflows: ["Continuous Integration"]
    types: completed
    
jobs:
  deploy:
    runs-on: ubuntu-latest

    if: github.event.workflow_run.conclusion == 'success'
    steps:
      - name: checkout the code.
        uses: actions/checkout@v2
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-region: us-east-1
          aws-access-key-id: ${{secrets.AWS_ACCESS_KEY_ID}}
          aws-secret-access-key: ${{secrets.AWS_SECRET_ACCESS_KEY}}
      - name: setup the kubectl
        uses: azure/setup-kubectl@v1
        with:
          version: 'latest'
      - name: verify the kubectl
        run: |
           kubectl version --client 
      - name: deployment the kubernates
        run: |
            echo "${{ secrets.KUBECONFIG_SECRET }}" | base64 -d > kubeconfig
            export KUBECONFIG=kubeconfig
            kubectl apply -f k8s
          
          
